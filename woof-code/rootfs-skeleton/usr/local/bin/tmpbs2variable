#!/bin/ash

if [ $# -lt 1 -o "$1" = "-h" -o "$1" = "--help" ]; then
	SHBASE="`basename $0`"
	echo "Echo <variable-name> value from BOOT_SPECS"
	echo "Usage: $SHBASE [-h|-q] variable-name"
	echo "Examples with 1 parameter:"
	echo " $SHBASE YDRV" 
	echo " $SHBASE PNOCOPY"
	echo "Examples with 2 parameters:"
	echo " $SHBASE -q YDRV"
	echo " $SHBASE -q PNOCOPY"
	echo "The \"-q\" parameter suppresses error messages."
	exit 1
fi
if [ "$1" = "-q" ]; then
	QUIET='yes'
	VAR_NAM="$2"
	exec 2>/dev/null
else
	QUIET=''
	VAR_NAM="$1"
fi

if [ "$VAR_NAM" = "" ]; then
	[ "$QUIET" ] || echo "Must specify a variable-name"
	exit 1
fi

CONF_FILE="$HOME/.config/boot_specs.conf"
if [ ! -f "$CONF_FILE" ]; then
	bootspecs2tmpbs -q
	if [ ! -f "$CONF_FILE" ]; then
		[ "$QUIET" ] || echo "Configuration file \"${CONF_FILE}\" not found."
		exit 1
	fi
fi
. "$CONF_FILE"
if [ ! -f "$SPECS_FN" ]; then
	bootspecs2tmpbs -q
	if [ ! -f "$SPECS_FN" ]; then
		[ "$QUIET" ] || echo "Bootspecs file \"${SPECS_FN}\" not found."
		exit 1
	fi
fi

VAR_VAL=''
VAR_LINE="$(grep "^${VAR_NAM}=" "$SPECS_FN")"
if [ "$VAR_LINE" ];then
	eval "$VAR_LINE"
	eval VAR_VAL="\$$VAR_NAM"
fi
[ "$VAR_VAL" ] && echo "$VAR_VAL"

exit
